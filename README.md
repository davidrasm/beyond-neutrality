# Phylodynamics Beyond Neutrality

Simulation and analysis code for exploring the effects of purifying selection on viral phylogenies and phylodynamic inference.

For more information, please see the our manuscript:

[Koelle, K. and Rasmussen, D.A. (2024) Phylodynamics beyond neutrality: The impact of incomplete purifying selection on viral phylogenies and inference. *In review*.][biorxiv-link]

[biorxiv-link]: <https://doi.org/10.1101/2024.08.28.610037>

## SLiM simulations

Our simulation in SLiM exploring how purifying selection impacts tree summary statistics can be replicated in full by running **run_slim_sims.py**. This script will run simulations at all unique model paramterizations we consider including each mutational fitness effect s_d, mutation rate and sampling interval considered in the paper.

The **slim** folder contains the scripts used to simulate epidemic trajectories and phylogenetic trees in SLiM.
- **linear_birth_death_fixed_sd.slim** can be run directly in SLiM to simulate trees with a fixed mutational fitness costs s_d.
- **linear_birth_death_low_mu.slim** and **linear_birth_death_high_mu.slim** are intended to be called from within **run_slim_sims.py** as they expect model parameters to be passed from the command line. The mutation rates are fixed and are set at their high/low values as given in the filename.

Note: environment.yml can be used to create a conda environment with SLiM, tskit and other required packages installed:
```
$ conda env create -f environment.yml
```

## Matlab simulations

Simulation code to generate the viral sequence data used as input into BEAST1 was implemented in Matlab (please see the manuscript).
Sequence data can be generated by following the steps below.

1. Run the .m file titled 'main_birthDeathSimulation_selection'. This file simulates the exact birth/death simulation model and outputs two files that are used in downstream analyses.

2. Run the .m file titled 'main_simulateBDTransmissionTree'. This file reads in one of the two output files from (1.), samples a specified number of individuals, and generates a genealogical tree for this sampled set of individuals

3. Run the .m file titled 'main_simulateSequencesFromTree'. This file reads in the true genealogy from (2.) and generates sequence data for the sampled individuals. There are two sequence data sets that are generated: one based on the true (observed) number of mutations that occur along the true genealogy and one based on a Poisson distribution. The latter data set is used to assess the impact of tree shape distortions alone on phylodynamic inference. The former data set is used to assess the joint impact of tree shape distortion and mutation distribution distortion on phylodynamic inference. Both datasets are in fasta file format and can be read into BEAST1.





